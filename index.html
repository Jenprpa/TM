<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Brain - Personal Knowledge Management</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/react-beautiful-dnd@13.1.1/dist/react-beautiful-dnd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #CFE0EB 0%, #DAFAFA 100%);
            min-height: 100vh;
            color: #000000;
        }

        .app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav {
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            background: #78A3D4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #8BADD3;
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: #93B9DD;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .priority-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .priority-card {
            background: linear-gradient(135deg, #78A3D4, #9DCAEB);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(120, 163, 212, 0.3);
        }

        .eisenhower-matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .matrix-quadrant {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            min-height: 300px;
            border: 2px dashed #ccc;
        }

        .urgent-important {
            background: rgba(255, 192, 203, 0.3);
            border-color: #FFC0CB;
        }

        .urgent-not-important {
            background: rgba(255, 255, 0, 0.3);
            border-color: #FFFF00;
        }

        .not-urgent-important {
            background: rgba(120, 163, 212, 0.1);
            border-color: #78A3D4;
        }

        .not-urgent-not-important {
            background: rgba(200, 200, 200, 0.3);
            border-color: #ccc;
        }

        .task-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: grab;
        }

        .task-item:active {
            cursor: grabbing;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #78A3D4;
        }

        .btn {
            background: #78A3D4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #8BADD3;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .table-view {
            overflow-x: auto;
        }

        .table-view table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-view th,
        .table-view td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table-view th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .priority-low {
            border-left: 4px solid #28a745;
        }

        .priority-medium {
            border-left: 4px solid #ffc107;
        }

        .priority-high {
            border-left: 4px solid #dc3545;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #9DCAEB, #AFD5F0);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .bulk-actions {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .selected-row {
            background-color: rgba(120, 163, 212, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { DragDropContext, Droppable, Draggable } = window.ReactBeautifulDnd;

        // Supabase configuration
        const supabaseUrl = 'https://raghhaggiefujvahpjvv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhZ2hoYWdnaWVmdWp2YWhwanZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNTExMDcsImV4cCI6MjA2OTcyNzEwN30.jV2X7K1RboM2dcF8biZIgTUz8HdoQ5E8s5WauGCH9PI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Main App Component
        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [areas, setAreas] = useState([]);
            const [projects, setProjects] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [notes, setNotes] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');

            // Load data from Supabase with improved error handling and SQL function compatibility
            const loadData = useCallback(async () => {
                try {
                    setLoading(true);
                    setError('');
                    
                    console.log('üîÑ Loading data from Supabase after SQL updates...');
                    
                    // Test connection first
                    const connectionTest = await supabase
                        .from('areas')
                        .select('count', { count: 'exact', head: true });
                    
                    if (connectionTest.error) {
                        console.error('Connection test failed:', connectionTest.error);
                        throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + connectionTest.error.message);
                    }
                    
                    console.log('‚úÖ Database connection successful');

                    // Load all data in parallel with better error handling
                    const [areasRes, projectsRes, tasksRes, notesRes] = await Promise.all([
                        supabase
                            .from('areas')
                            .select('*')
                            .order('updated_at', { ascending: false })
                            .then(res => ({ ...res, table: 'areas' })),
                        
                        supabase
                            .from('projects')
                            .select('*')
                            .order('updated_at', { ascending: false })
                            .then(res => ({ ...res, table: 'projects' })),
                        
                        supabase
                            .from('tasks')
                            .select('*')
                            .order('updated_at', { ascending: false })
                            .then(res => ({ ...res, table: 'tasks' })),
                        
                        supabase
                            .from('notes')
                            .select('*')
                            .order('updated_at', { ascending: false })
                            .then(res => ({ ...res, table: 'notes' }))
                    ]);

                    // Handle individual table errors gracefully
                    const areasData = areasRes.error ? [] : (areasRes.data || []);
                    const projectsData = projectsRes.error ? [] : (projectsRes.data || []);
                    const tasksData = tasksRes.error ? [] : (tasksRes.data || []);
                    const notesData = notesRes.error ? [] : (notesRes.data || []);

                    // Log any individual errors
                    if (areasRes.error) console.warn('Areas loading error:', areasRes.error);
                    if (projectsRes.error) console.warn('Projects loading error:', projectsRes.error);
                    if (tasksRes.error) console.warn('Tasks loading error:', tasksRes.error);
                    if (notesRes.error) console.warn('Notes loading error:', notesRes.error);

                    // Build relationships safely
                    const projectsWithAreas = projectsData.map(project => ({
                        ...project,
                        areas: project.area_id ? areasData.find(area => area.id === project.area_id) : null
                    }));

                    const tasksWithRelations = tasksData.map(task => {
                        const project = projectsData.find(p => p.id === task.project_id);
                        const area = project ? areasData.find(a => a.id === project.area_id) : 
                                     task.area_id ? areasData.find(a => a.id === task.area_id) : null;
                        return {
                            ...task,
                            projects: project,
                            areas: area
                        };
                    });

                    const notesWithRelations = notesData.map(note => ({
                        ...note,
                        projects: note.project_id ? projectsData.find(p => p.id === note.project_id) : null,
                        areas: note.area_id ? areasData.find(a => a.id === note.area_id) : null
                    }));

                    // Update state
                    setAreas(areasData);
                    setProjects(projectsWithAreas);
                    setTasks(tasksWithRelations);
                    setNotes(notesWithRelations);

                    // Success message with statistics
                    const stats = {
                        areas: areasData.length,
                        projects: projectsWithAreas.length,
                        tasks: tasksWithRelations.length,
                        notes: notesWithRelations.length,
                        total: areasData.length + projectsWithAreas.length + tasksWithRelations.length + notesWithRelations.length
                    };

                    console.log('üìä Data loaded successfully:', stats);
                    
                    if (stats.total > 0) {
                        setSuccess(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${stats.areas}, ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ: ${stats.projects}, ‡∏á‡∏≤‡∏ô: ${stats.tasks}, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${stats.notes}`);
                    } else {
                        setSuccess('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà');
                    }

                } catch (err) {
                    console.error('‚ùå Load data error:', err);
                    setError(err.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                    
                    // Set empty arrays to prevent crashes
                    setAreas([]);
                    setProjects([]);
                    setTasks([]);
                    setNotes([]);
                } finally {
                    setLoading(false);
                }
            }, []);

            // Auto-promotion system
            const checkAutoPromotion = useCallback(async () => {
                try {
                    const threeDaysFromNow = new Date();
                    threeDaysFromNow.setDate(threeDaysFromNow.getDate() + 3);
                    
                    const tasksToPromote = tasks.filter(task => 
                        task.category === 'not-urgent-important' &&
                        task.due_date &&
                        new Date(task.due_date) <= threeDaysFromNow &&
                        task.status !== 'completed'
                    );

                    for (const task of tasksToPromote) {
                        await supabase
                            .from('tasks')
                            .update({ category: 'urgent-important' })
                            .eq('id', task.id);
                    }

                    if (tasksToPromote.length > 0) {
                        setSuccess(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ${tasksToPromote.length} ‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡πâ‡∏ß`);
                        loadData();
                    }
                } catch (err) {
                    console.error('Auto-promotion error:', err);
                }
            }, [tasks, loadData]);

            useEffect(() => {
                loadData();
            }, [loadData]);

            useEffect(() => {
                // Check auto-promotion every hour
                const interval = setInterval(checkAutoPromotion, 3600000);
                return () => clearInterval(interval);
            }, [checkAutoPromotion]);

            const showMessage = (message, type = 'success') => {
                if (type === 'success') {
                    setSuccess(message);
                    setTimeout(() => setSuccess(''), 3000);
                } else {
                    setError(message);
                    setTimeout(() => setError(''), 3000);
                }
            };

            if (loading) {
                return <div className="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>;
            }

            return (
                <div className="app">
                    <header className="header">
                        <h1 style={{ color: '#78A3D4', fontSize: '2rem' }}>üß† Second Brain</h1>
                        <nav className="nav">
                            <button 
                                className={`nav-btn ${currentView === 'dashboard' ? 'active' : ''}`}
                                onClick={() => setCurrentView('dashboard')}
                            >
                                ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                            </button>
                            <button 
                                className={`nav-btn ${currentView === 'tasks' ? 'active' : ''}`}
                                onClick={() => setCurrentView('tasks')}
                            >
                                ‡∏á‡∏≤‡∏ô
                            </button>
                            <button 
                                className={`nav-btn ${currentView === 'projects' ? 'active' : ''}`}
                                onClick={() => setCurrentView('projects')}
                            >
                                ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
                            </button>
                            <button 
                                className={`nav-btn ${currentView === 'areas' ? 'active' : ''}`}
                                onClick={() => setCurrentView('areas')}
                            >
                                ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                            </button>
                            <button 
                                className={`nav-btn ${currentView === 'notes' ? 'active' : ''}`}
                                onClick={() => setCurrentView('notes')}
                            >
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </button>
                        </nav>
                    </header>

                    {error && <div className="error">{error}</div>}
                    {success && <div className="success">{success}</div>}

                    {currentView === 'dashboard' && (
                        <Dashboard 
                            tasks={tasks} 
                            areas={areas} 
                            projects={projects} 
                            notes={notes}
                            onTaskUpdate={loadData}
                            showMessage={showMessage}
                        />
                    )}
                    {currentView === 'tasks' && (
                        <TaskManager 
                            tasks={tasks} 
                            projects={projects} 
                            areas={areas}
                            onUpdate={loadData}
                            showMessage={showMessage}
                        />
                    )}
                    {currentView === 'projects' && (
                        <ProjectManager 
                            projects={projects} 
                            areas={areas}
                            onUpdate={loadData}
                            showMessage={showMessage}
                        />
                    )}
                    {currentView === 'areas' && (
                        <AreaManager 
                            areas={areas}
                            onUpdate={loadData}
                            showMessage={showMessage}
                        />
                    )}
                    {currentView === 'notes' && (
                        <NoteManager 
                            notes={notes} 
                            projects={projects} 
                            areas={areas}
                            onUpdate={loadData}
                            showMessage={showMessage}
                        />
                    )}
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ tasks, areas, projects, notes, onTaskUpdate, showMessage }) {
            const highPriorityTasks = tasks
                .filter(task => task.priority === 'high' && task.status !== 'completed')
                .sort((a, b) => new Date(a.due_date || '9999-12-31') - new Date(b.due_date || '9999-12-31'))
                .slice(0, 3);

            const tasksByCategory = {
                'urgent-important': tasks.filter(t => t.category === 'urgent-important' && !t.completed && t.status !== 'completed'),
                'not-urgent-important': tasks.filter(t => t.category === 'not-urgent-important' && !t.completed && t.status !== 'completed'),
                'urgent-not-important': tasks.filter(t => t.category === 'urgent-not-important' && !t.completed && t.status !== 'completed'),
                'not-urgent-not-important': tasks.filter(t => t.category === 'not-urgent-not-important' && !t.completed && t.status !== 'completed')
            };

            const completedTasks = tasks.filter(task => task.completed || task.status === 'completed');

            const handleDragEnd = async (result) => {
                if (!result.destination) return;

                const taskId = result.draggableId;
                const newCategory = result.destination.droppableId;

                try {
                    const { error } = await supabase
                        .from('tasks')
                        .update({ category: newCategory })
                        .eq('id', taskId);

                    if (error) throw error;

                    showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    onTaskUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ' + err.message, 'error');
                }
            };

            const toggleTaskComplete = async (taskId, completed) => {
                try {
                    const { error } = await supabase
                        .from('tasks')
                        .update({ 
                            completed: !completed,
                            completed_at: !completed ? new Date().toISOString() : null
                        })
                        .eq('id', taskId);

                    if (error) throw error;

                    showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    onTaskUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ' + err.message, 'error');
                }
            };

            return (
                <div>
                    {/* Statistics */}
                    <div className="stats">
                        <div className="stat-card">
                            <div className="stat-number">{areas.length}</div>
                            <div className="stat-label">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{projects.length}</div>
                            <div className="stat-label">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{tasks.filter(t => t.status !== 'completed' && !t.completed).length}</div>
                            <div className="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{completedTasks.length}</div>
                            <div className="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{notes.length}</div>
                            <div className="stat-label">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
                        </div>
                    </div>

                    {/* Top 3 High Priority Tasks */}
                    <div className="card">
                        <h2 style={{ color: '#78A3D4', marginBottom: '20px' }}>üî• ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô (Top 3)</h2>
                        <div className="priority-cards">
                            {highPriorityTasks.length > 0 ? highPriorityTasks.map(task => (
                                <div key={task.id} className="priority-card">
                                    <h3>{task.title}</h3>
                                    <p>{task.description}</p>
                                    <p><strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:</strong> {task.due_date ? new Date(task.due_date).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                    <p><strong>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</strong> {task.projects?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                    <button 
                                        className="btn btn-success"
                                        onClick={() => toggleTaskComplete(task.id, task.completed)}
                                        style={{ marginTop: '10px' }}
                                    >
                                        ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                                    </button>
                                </div>
                            )) : (
                                <div className="priority-card">
                                    <h3>üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h3>
                                    <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Completed Tasks */}
                    <div className="card">
                        <h2 style={{ color: '#78A3D4', marginBottom: '20px' }}>‚úÖ ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h2>
                        <div className="grid-view" style={{ maxHeight: '300px', overflowY: 'auto' }}>
                            {completedTasks.length > 0 ? (
                                completedTasks
                                    .sort((a, b) => new Date(b.completed_at || b.updated_at) - new Date(a.completed_at || a.updated_at))
                                    .slice(0, 6)
                                    .map(task => (
                                        <div key={task.id} className="card" style={{ opacity: 0.8, background: 'linear-gradient(135deg, #d4edda, #c3e6cb)' }}>
                                            <h4 style={{ textDecoration: 'line-through', color: '#155724' }}>{task.title}</h4>
                                            <p style={{ fontSize: '0.9rem', color: '#155724' }}>{task.description}</p>
                                            <p style={{ fontSize: '0.8rem', opacity: 0.7 }}>
                                                <strong>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> {task.completed_at ? new Date(task.completed_at).toLocaleDateString('th-TH') : new Date(task.updated_at).toLocaleDateString('th-TH')}
                                            </p>
                                            <p style={{ fontSize: '0.8rem', opacity: 0.7 }}>
                                                <strong>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</strong> {task.projects?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                                            </p>
                                        </div>
                                    ))
                            ) : (
                                <div className="card" style={{ textAlign: 'center', opacity: 0.6 }}>
                                    <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h4>
                                    <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Eisenhower Matrix */}
                    <div className="card">
                        <h2 style={{ color: '#78A3D4', marginBottom: '20px' }}>üìä Eisenhower Matrix</h2>
                        <DragDropContext onDragEnd={handleDragEnd}>
                            <div className="eisenhower-matrix">
                                {Object.entries(tasksByCategory).map(([category, categoryTasks]) => (
                                    <Droppable key={category} droppableId={category}>
                                        {(provided) => (
                                            <div
                                                ref={provided.innerRef}
                                                {...provided.droppableProps}
                                                className={`matrix-quadrant ${category}`}
                                            >
                                                <h3 style={{ marginBottom: '15px', textAlign: 'center' }}>
                                                    {category === 'urgent-important' && 'üî• ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô + ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                    {category === 'not-urgent-important' && 'üìÖ ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô + ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                    {category === 'urgent-not-important' && '‚ö° ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô + ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                    {category === 'not-urgent-not-important' && 'üìù ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô + ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                </h3>
                                                {categoryTasks.map((task, index) => (
                                                    <Draggable key={task.id} draggableId={String(task.id)} index={index}>
                                                        {(provided) => (
                                                            <div
                                                                ref={provided.innerRef}
                                                                {...provided.draggableProps}
                                                                {...provided.dragHandleProps}
                                                                className={`task-item priority-${task.priority}`}
                                                            >
                                                                <h4>{task.title}</h4>
                                                                <p style={{ fontSize: '0.9rem', opacity: 0.8 }}>
                                                                    {task.due_date && `üìÖ ${new Date(task.due_date).toLocaleDateString('th-TH')}`}
                                                                </p>
                                                                <button 
                                                                    className="btn btn-success"
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        toggleTaskComplete(task.id, task.completed);
                                                                    }}
                                                                    style={{ marginTop: '8px', padding: '5px 10px', fontSize: '0.8rem' }}
                                                                >
                                                                    ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à
                                                                </button>
                                                            </div>
                                                        )}
                                                    </Draggable>
                                                ))}
                                                {provided.placeholder}
                                                {categoryTasks.length === 0 && (
                                                    <p style={{ textAlign: 'center', opacity: 0.5, marginTop: '50px' }}>
                                                        ‡∏•‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                                                    </p>
                                                )}
                                            </div>
                                        )}
                                    </Droppable>
                                ))}
                            </div>
                        </DragDropContext>
                    </div>
                </div>
            );
        }
        
        // Confirmation Modal Component
        function ConfirmModal({ show, onClose, onConfirm, title, message }) {
            if (!show) {
                return null;
            }

            return (
                <div className="modal">
                    <div className="modal-content">
                        <h3>{title}</h3>
                        <p style={{ margin: '20px 0', whiteSpace: 'pre-wrap' }}>{message}</p>
                        <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                            <button type="button" className="btn" onClick={onClose}>
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                            <button type="button" className="btn btn-danger" onClick={onConfirm}>
                                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Task Manager Component
        function TaskManager({ tasks, projects, areas, onUpdate, showMessage }) {
            const [showModal, setShowModal] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [selectedTasks, setSelectedTasks] = useState([]);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });
            const [formData, setFormData] = useState({
                title: '',
                description: '',
                due_date: '',
                priority: 'medium',
                category: 'not-urgent-important',
                status: 'pending',
                project_id: '',
                area_id: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const data = {
                        ...formData,
                        project_id: formData.project_id || null,
                        area_id: formData.area_id || null,
                        due_date: formData.due_date || null
                    };

                    if (editingTask) {
                        const { error } = await supabase
                            .from('tasks')
                            .update(data)
                            .eq('id', editingTask.id);
                        if (error) throw error;
                        showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    } else {
                        const { error } = await supabase
                            .from('tasks')
                            .insert([data]);
                        if (error) throw error;
                        showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    }

                    setShowModal(false);
                    setEditingTask(null);
                    setFormData({
                        title: '',
                        description: '',
                        due_date: '',
                        priority: 'medium',
                        category: 'not-urgent-important',
                        status: 'pending',
                        project_id: '',
                        area_id: ''
                    });
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            const handleEdit = (task) => {
                setEditingTask(task);
                setFormData({
                    title: task.title,
                    description: task.description || '',
                    due_date: task.due_date || '',
                    priority: task.priority,
                    category: task.category,
                    status: task.status || 'pending',
                    project_id: task.project_id || '',
                    area_id: task.area_id || ''
                });
                setShowModal(true);
            };

            const handleDelete = (taskId) => {
                const taskToDelete = tasks.find(t => t.id === taskId);
                const taskName = taskToDelete ? taskToDelete.title : '‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ';
                
                setConfirmModal({
                    isOpen: true,
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö "${taskName}"?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Attempting to delete task:', { id: taskId, name: taskName });
                            
                            const { error } = await supabase
                                .from('tasks')
                                .delete()
                                .eq('id', taskId);

                            if (error) {
                                console.error('‚ùå Supabase delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏á‡∏≤‡∏ô "${taskName}" ‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Task deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏á‡∏≤‡∏ô "${taskName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Unexpected delete error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleBulkDelete = () => {
                if (selectedTasks.length === 0) {
                    showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                    return;
                }

                const taskNames = selectedTasks.map(id => {
                    const task = tasks.find(t => t.id === id);
                    return task ? task.title : '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
                });

                setConfirmModal({
                    isOpen: true,
                    title: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${selectedTasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedTasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n\nüìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö:\n${taskNames.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Bulk deleting tasks:', selectedTasks);
                            
                            const { error } = await supabase
                                .from('tasks')
                                .delete()
                                .in('id', selectedTasks);

                            if (error) {
                                console.error('‚ùå Bulk delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Tasks bulk deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedTasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            setSelectedTasks([]);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Bulk delete tasks error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleSelectTask = (taskId) => {
                setSelectedTasks(prev => 
                    prev.includes(taskId) 
                        ? prev.filter(id => id !== taskId)
                        : [...prev, taskId]
                );
            };

            const handleSelectAll = () => {
                if (selectedTasks.length === tasks.length) {
                    setSelectedTasks([]);
                } else {
                    setSelectedTasks(tasks.map(task => task.id));
                }
            };

            const cyclePriority = async (task) => {
                const priorities = ['low', 'medium', 'high'];
                const currentIndex = priorities.indexOf(task.priority);
                const nextPriority = priorities[(currentIndex + 1) % priorities.length];

                try {
                    const { error } = await supabase
                        .from('tasks')
                        .update({ priority: nextPriority })
                        .eq('id', task.id);

                    if (error) throw error;
                    showMessage(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏õ‡πá‡∏ô ${nextPriority} ‡πÅ‡∏•‡πâ‡∏ß`);
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            const toggleComplete = async (task) => {
                try {
                    const newStatus = task.status === 'completed' ? 'pending' : 'completed';
                    const { error } = await supabase
                        .from('tasks')
                        .update({ 
                            status: newStatus
                        })
                        .eq('id', task.id);

                    if (error) throw error;
                    showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h2 style={{ color: '#78A3D4' }}>‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h2>
                            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>
                                <button className="btn" onClick={() => setShowModal(true)}>
                                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                                </button>
                            </div>
                        </div>

                        {selectedTasks.length > 0 && (
                            <div className="bulk-actions">
                                <span style={{ fontSize: '0.9rem', color: '#721c24' }}>
                                    üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß {selectedTasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                                </span>
                                <button 
                                    className="btn btn-danger" 
                                    onClick={handleBulkDelete}
                                    style={{ margin: 0 }}
                                >
                                    üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ({selectedTasks.length})
                                </button>
                            </div>
                        )}

                        <div className="table-view">
                            <table>
                                <thead>
                                    <tr>
                                        <th className="checkbox-cell">
                                            <input
                                                type="checkbox"
                                                checked={selectedTasks.length === tasks.length && tasks.length > 0}
                                                onChange={handleSelectAll}
                                                title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                                            />
                                        </th>
                                        <th>‡∏á‡∏≤‡∏ô</th>
                                        <th>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</th>
                                        <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th>
                                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                        <th>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {tasks.map(task => (
                                        <tr 
                                            key={task.id} 
                                            className={`${task.status === 'completed' ? 'completed' : ''} ${selectedTasks.includes(task.id) ? 'selected-row' : ''}`}
                                        >
                                            <td className="checkbox-cell">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedTasks.includes(task.id)}
                                                    onChange={() => handleSelectTask(task.id)}
                                                />
                                            </td>
                                            <td>
                                                <strong>{task.title}</strong>
                                                {task.description && <div style={{ fontSize: '0.9rem', opacity: 0.7 }}>{task.description}</div>}
                                            </td>
                                            <td>{task.due_date ? new Date(task.due_date).toLocaleDateString('th-TH') : '-'}</td>
                                            <td>
                                                <span className={`priority-${task.priority}`}>
                                                    {task.priority === 'high' && 'üî¥ ‡∏™‡∏π‡∏á'}
                                                    {task.priority === 'medium' && 'ÔøΩ ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á'}
                                                    {task.priority === 'low' && 'üü¢ ‡∏ï‡πà‡∏≥'}
                                                </span>
                                            </td>
                                            <td>
                                                {task.category === 'urgent-important' && 'üî• ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô+‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                {task.category === 'not-urgent-important' && 'üìÖ ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô+‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                {task.category === 'urgent-not-important' && '‚ö° ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô+‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                                {task.category === 'not-urgent-not-important' && 'üìù ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô+‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'}
                                            </td>
                                            <td>{task.projects?.name || '-'}</td>
                                            <td>
                                                <button 
                                                    className={`btn ${task.status === 'completed' ? 'btn-warning' : 'btn-success'}`}
                                                    onClick={() => toggleComplete(task)}
                                                >
                                                    {task.status === 'completed' ? '‚Ü©Ô∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à'}
                                                </button>
                                            </td>
                                            <td>
                                                <button 
                                                    className="btn btn-warning"
                                                    onClick={() => cyclePriority(task)}
                                                    title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"
                                                >
                                                    üîÑ Priority
                                                </button>
                                                <button 
                                                    className="btn"
                                                    onClick={() => handleEdit(task)}
                                                >
                                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                </button>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => handleDelete(task.id)}
                                                >
                                                    üóëÔ∏è ‡∏•‡∏ö
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3>{editingTask ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà'}</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô *</label>
                                        <input
                                            type="text"
                                            value={formData.title}
                                            onChange={(e) => setFormData({...formData, title: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                        <textarea
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                            rows="3"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</label>
                                        <input
                                            type="date"
                                            value={formData.due_date}
                                            onChange={(e) => setFormData({...formData, due_date: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                                        <select
                                            value={formData.priority}
                                            onChange={(e) => setFormData({...formData, priority: e.target.value})}
                                        >
                                            <option value="low">‡∏ï‡πà‡∏≥</option>
                                            <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                                            <option value="high">‡∏™‡∏π‡∏á</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                        <select
                                            value={formData.category}
                                            onChange={(e) => setFormData({...formData, category: e.target.value})}
                                        >
                                            <option value="urgent-important">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                                            <option value="not-urgent-important">‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÅ‡∏ï‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                                            <option value="urgent-not-important">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                                            <option value="not-urgent-not-important">‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</label>
                                        <select
                                            value={formData.project_id}
                                            onChange={(e) => setFormData({...formData, project_id: e.target.value})}
                                        >
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ --</option>
                                            {projects.map(project => (
                                                <option key={project.id} value={project.id}>
                                                    {project.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</label>
                                        <select
                                            value={formData.area_id}
                                            onChange={(e) => setFormData({...formData, area_id: e.target.value})}
                                        >
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà --</option>
                                            {areas.map(area => (
                                                <option key={area.id} value={area.id}>
                                                    {area.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button type="button" className="btn" onClick={() => setShowModal(false)}>
                                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                        </button>
                                        <button type="submit" className="btn btn-success">
                                            {editingTask ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï' : '‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    <ConfirmModal
                        show={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                </div>
            );
        }

        // Project Manager Component
        function ProjectManager({ projects, areas, onUpdate, showMessage }) {
            const [viewMode, setViewMode] = useState('grid');
            const [showModal, setShowModal] = useState(false);
            const [editingProject, setEditingProject] = useState(null);
            const [selectedProjects, setSelectedProjects] = useState([]);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });
            const [formData, setFormData] = useState({
                name: '',
                description: '',
                area_id: '',
                status: 'active',
                start_date: '',
                end_date: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const data = {
                        ...formData,
                        area_id: formData.area_id || null,
                        start_date: formData.start_date || null,
                        end_date: formData.end_date || null
                    };

                    if (editingProject) {
                        const { error } = await supabase
                            .from('projects')
                            .update(data)
                            .eq('id', editingProject.id);
                        if (error) throw error;
                        showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    } else {
                        const { error } = await supabase
                            .from('projects')
                            .insert([data]);
                        if (error) throw error;
                        showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    }

                    setShowModal(false);
                    setEditingProject(null);
                    setFormData({
                        name: '',
                        description: '',
                        area_id: '',
                        status: 'active',
                        start_date: '',
                        end_date: ''
                    });
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            const handleEdit = (project) => {
                setEditingProject(project);
                setFormData({
                    name: project.name,
                    description: project.description || '',
                    area_id: project.area_id || '',
                    status: project.status,
                    start_date: project.start_date || '',
                    end_date: project.end_date || ''
                });
                setShowModal(true);
            };

            const handleDelete = (projectId) => {
                const projectToDelete = projects.find(p => p.id === projectId);
                const projectName = projectToDelete ? projectToDelete.name : '‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ';
                
                setConfirmModal({
                    isOpen: true,
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö "${projectName}"?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Attempting to delete project:', { id: projectId, name: projectName });
                            
                            const { error } = await supabase
                                .from('projects')
                                .delete()
                                .eq('id', projectId);

                            if (error) {
                                console.error('‚ùå Supabase delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ "${projectName}" ‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Project deleted successfully');
                            showMessage(`‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ "${projectName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Unexpected delete error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleBulkDelete = () => {
                if (selectedProjects.length === 0) {
                    showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                    return;
                }

                const projectNames = selectedProjects.map(id => {
                    const project = projects.find(p => p.id === id);
                    return project ? project.name : '‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
                });

                setConfirmModal({
                    isOpen: true,
                    title: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${selectedProjects.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedProjects.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n\nüìã ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö:\n${projectNames.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Bulk deleting projects:', selectedProjects);
                            
                            const { error } = await supabase
                                .from('projects')
                                .delete()
                                .in('id', selectedProjects);

                            if (error) {
                                console.error('‚ùå Bulk delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Projects bulk deleted successfully');
                            showMessage(`‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedProjects.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            setSelectedProjects([]);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Bulk delete projects error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleSelectProject = (projectId) => {
                setSelectedProjects(prev => 
                    prev.includes(projectId) 
                        ? prev.filter(id => id !== projectId)
                        : [...prev, projectId]
                );
            };

            const handleSelectAll = () => {
                if (selectedProjects.length === projects.length) {
                    setSelectedProjects([]);
                } else {
                    setSelectedProjects(projects.map(project => project.id));
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h2 style={{ color: '#78A3D4' }}>üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</h2>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <div className="view-toggle">
                                    <button 
                                        className={`btn ${viewMode === 'grid' ? 'active' : ''}`}
                                        onClick={() => setViewMode('grid')}
                                    >
                                        üî≤ Grid
                                    </button>
                                    <button 
                                        className={`btn ${viewMode === 'table' ? 'active' : ''}`}
                                        onClick={() => setViewMode('table')}
                                    >
                                        üìã Table
                                    </button>
                                </div>
                                <button className="btn" onClick={() => setShowModal(true)}>
                                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
                                </button>
                            </div>
                        </div>

                        {selectedProjects.length > 0 && (
                            <div className="bulk-actions">
                                <span style={{ fontSize: '0.9rem', color: '#721c24' }}>
                                    üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß {selectedProjects.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                                </span>
                                <button 
                                    className="btn btn-danger" 
                                    onClick={handleBulkDelete}
                                    style={{ margin: 0 }}
                                >
                                    üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ({selectedProjects.length})
                                </button>
                            </div>
                        )}

                        {viewMode === 'grid' ? (
                            <div className="grid-view">
                                {projects.map(project => (
                                    <div key={project.id} className={`card ${selectedProjects.includes(project.id) ? 'selected-row' : ''}`}>
                                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '10px', marginBottom: '10px' }}>
                                            <input
                                                type="checkbox"
                                                checked={selectedProjects.includes(project.id)}
                                                onChange={() => handleSelectProject(project.id)}
                                                style={{ marginTop: '2px' }}
                                            />
                                            <div style={{ flex: 1 }}>
                                                <h3>{project.name}</h3>
                                                <p>{project.description}</p>
                                                <p><strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</strong> {project.areas?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                                <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                                                    <span style={{ 
                                                        color: project.status === 'active' ? '#28a745' : 
                                                               project.status === 'completed' ? '#007bff' : '#ffc107'
                                                    }}>
                                                        {project.status === 'active' && ' üü¢ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                                                        {project.status === 'completed' && ' ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}
                                                        {project.status === 'on-hold' && ' ‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'}
                                                    </span>
                                                </p>
                                                {project.start_date && (
                                                    <p><strong>‡πÄ‡∏£‡∏¥‡πà‡∏°:</strong> {new Date(project.start_date).toLocaleDateString('th-TH')}</p>
                                                )}
                                                {project.end_date && (
                                                    <p><strong>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</strong> {new Date(project.end_date).toLocaleDateString('th-TH')}</p>
                                                )}
                                            </div>
                                        </div>
                                        <div style={{ marginTop: '15px' }}>
                                            <button 
                                                className="btn"
                                                onClick={() => handleEdit(project)}
                                            >
                                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                            </button>
                                            <button 
                                                className="btn btn-danger"
                                                onClick={() => handleDelete(project.id)}
                                            >
                                                üóëÔ∏è ‡∏•‡∏ö
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="table-view">
                                <table>
                                    <thead>
                                        <tr>
                                            <th className="checkbox-cell">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedProjects.length === projects.length && projects.length > 0}
                                                    onChange={handleSelectAll}
                                                    title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                                                />
                                            </th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</th>
                                            <th>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
                                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
                                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projects.map(project => (
                                            <tr key={project.id} className={selectedProjects.includes(project.id) ? 'selected-row' : ''}>
                                                <td className="checkbox-cell">
                                                    <input
                                                        type="checkbox"
                                                        checked={selectedProjects.includes(project.id)}
                                                        onChange={() => handleSelectProject(project.id)}
                                                    />
                                                </td>
                                                <td>
                                                    <strong>{project.name}</strong>
                                                    {project.description && <div style={{ fontSize: '0.9rem', opacity: 0.7 }}>{project.description}</div>}
                                                </td>
                                                <td>{project.areas?.name || '-'}</td>
                                                <td>
                                                    <span style={{ 
                                                        color: project.status === 'active' ? '#28a745' : 
                                                               project.status === 'completed' ? '#007bff' : '#ffc107'
                                                    }}>
                                                        {project.status === 'active' && 'üü¢ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                                                        {project.status === 'completed' && '‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}
                                                        {project.status === 'on-hold' && '‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'}
                                                    </span>
                                                </td>
                                                <td>{project.start_date ? new Date(project.start_date).toLocaleDateString('th-TH') : '-'}</td>
                                                <td>{project.end_date ? new Date(project.end_date).toLocaleDateString('th-TH') : '-'}</td>
                                                <td>
                                                    <button 
                                                        className="btn"
                                                        onClick={() => handleEdit(project)}
                                                    >
                                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                    </button>
                                                    <button 
                                                        className="btn btn-danger"
                                                        onClick={() => handleDelete(project.id)}
                                                    >
                                                        üóëÔ∏è ‡∏•‡∏ö
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3>{editingProject ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà'}</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ *</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                        <textarea
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                            rows="3"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</label>
                                        <select
                                            value={formData.area_id}
                                            onChange={(e) => setFormData({...formData, area_id: e.target.value})}
                                        >
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà --</option>
                                            {areas.map(area => (
                                                <option key={area.id} value={area.id}>
                                                    {area.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                                        <select
                                            value={formData.status}
                                            onChange={(e) => setFormData({...formData, status: e.target.value})}
                                        >
                                            <option value="active">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                                            <option value="on-hold">‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                                        <input
                                            type="date"
                                            value={formData.start_date}
                                            onChange={(e) => setFormData({...formData, start_date: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                                        <input
                                            type="date"
                                            value={formData.end_date}
                                            onChange={(e) => setFormData({...formData, end_date: e.target.value})}
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button type="button" className="btn" onClick={() => setShowModal(false)}>
                                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                        </button>
                                        <button type="submit" className="btn btn-success">
                                            {editingProject ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï' : '‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                     <ConfirmModal
                        show={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                </div>
            );
        }

        // Area Manager Component
        function AreaManager({ areas, onUpdate, showMessage }) {
            const [viewMode, setViewMode] = useState('grid');
            const [showModal, setShowModal] = useState(false);
            const [editingArea, setEditingArea] = useState(null);
            const [selectedAreas, setSelectedAreas] = useState([]);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });
            const [formData, setFormData] = useState({
                name: '',
                description: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    if (editingArea) {
                        const { error } = await supabase
                            .from('areas')
                            .update(formData)
                            .eq('id', editingArea.id);
                        if (error) throw error;
                        showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    } else {
                        const { error } = await supabase
                            .from('areas')
                            .insert([formData]);
                        if (error) throw error;
                        showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    }

                    setShowModal(false);
                    setEditingArea(null);
                    setFormData({ name: '', description: '' });
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            const handleEdit = (area) => {
                setEditingArea(area);
                setFormData({
                    name: area.name,
                    description: area.description || ''
                });
                setShowModal(true);
            };

            const handleDelete = (areaId) => {
                const areaToDelete = areas.find(a => a.id === areaId);
                const areaName = areaToDelete ? areaToDelete.name : '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ';
                
                setConfirmModal({
                    isOpen: true,
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö "${areaName}"?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Attempting to delete area:', { id: areaId, name: areaName });
                            
                            const { error } = await supabase
                                .from('areas')
                                .delete()
                                .eq('id', areaId);

                            if (error) {
                                console.error('‚ùå Supabase delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà "${areaName}" ‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Area deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà "${areaName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Unexpected delete error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleBulkDelete = () => {
                if (selectedAreas.length === 0) {
                    showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                    return;
                }

                const areaNames = selectedAreas.map(id => {
                    const area = areas.find(a => a.id === id);
                    return area ? area.name : '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
                });

                setConfirmModal({
                    isOpen: true,
                    title: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${selectedAreas.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedAreas.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n\nüìã ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö:\n${areaNames.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Bulk deleting areas:', selectedAreas);
                            
                            const { error } = await supabase
                                .from('areas')
                                .delete()
                                .in('id', selectedAreas);

                            if (error) {
                                console.error('‚ùå Bulk delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Areas bulk deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedAreas.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            setSelectedAreas([]);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Bulk delete areas error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleSelectArea = (areaId) => {
                setSelectedAreas(prev => 
                    prev.includes(areaId) 
                        ? prev.filter(id => id !== areaId)
                        : [...prev, areaId]
                );
            };

            const handleSelectAll = () => {
                if (selectedAreas.length === areas.length) {
                    setSelectedAreas([]);
                } else {
                    setSelectedAreas(areas.map(area => area.id));
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h2 style={{ color: '#78A3D4' }}>üéØ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</h2>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <div className="view-toggle">
                                    <button 
                                        className={`btn ${viewMode === 'grid' ? 'active' : ''}`}
                                        onClick={() => setViewMode('grid')}
                                    >
                                        üî≤ Grid
                                    </button>
                                    <button 
                                        className={`btn ${viewMode === 'table' ? 'active' : ''}`}
                                        onClick={() => setViewMode('table')}
                                    >
                                        üìã Table
                                    </button>
                                </div>
                                <button className="btn" onClick={() => setShowModal(true)}>
                                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                                </button>
                            </div>
                        </div>

                        {selectedAreas.length > 0 && (
                            <div className="bulk-actions">
                                <span style={{ fontSize: '0.9rem', color: '#721c24' }}>
                                    üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß {selectedAreas.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                                </span>
                                <button 
                                    className="btn btn-danger" 
                                    onClick={handleBulkDelete}
                                    style={{ margin: 0 }}
                                >
                                    üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ({selectedAreas.length})
                                </button>
                            </div>
                        )}

                        {viewMode === 'grid' ? (
                            <div className="grid-view">
                                {areas.map(area => (
                                    <div key={area.id} className={`card ${selectedAreas.includes(area.id) ? 'selected-row' : ''}`}>
                                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '10px', marginBottom: '10px' }}>
                                            <input
                                                type="checkbox"
                                                checked={selectedAreas.includes(area.id)}
                                                onChange={() => handleSelectArea(area.id)}
                                                style={{ marginTop: '2px' }}
                                            />
                                            <div style={{ flex: 1 }}>
                                                <h3>{area.name}</h3>
                                                <p>{area.description}</p>
                                                <p style={{ fontSize: '0.9rem', opacity: 0.7 }}>
                                                    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {new Date(area.created_at).toLocaleDateString('th-TH')}
                                                </p>
                                            </div>
                                        </div>
                                        <div style={{ marginTop: '15px' }}>
                                            <button 
                                                className="btn"
                                                onClick={() => handleEdit(area)}
                                            >
                                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                            </button>
                                            <button 
                                                className="btn btn-danger"
                                                onClick={() => handleDelete(area.id)}
                                            >
                                                üóëÔ∏è ‡∏•‡∏ö
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="table-view">
                                <table>
                                    <thead>
                                        <tr>
                                            <th className="checkbox-cell">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedAreas.length === areas.length && areas.length > 0}
                                                    onChange={handleSelectAll}
                                                    title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                                                />
                                            </th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {areas.map(area => (
                                            <tr key={area.id} className={selectedAreas.includes(area.id) ? 'selected-row' : ''}>
                                                <td className="checkbox-cell">
                                                    <input
                                                        type="checkbox"
                                                        checked={selectedAreas.includes(area.id)}
                                                        onChange={() => handleSelectArea(area.id)}
                                                    />
                                                </td>
                                                <td><strong>{area.name}</strong></td>
                                                <td>{area.description || '-'}</td>
                                                <td>{new Date(area.created_at).toLocaleDateString('th-TH')}</td>
                                                <td>
                                                    <button 
                                                        className="btn"
                                                        onClick={() => handleEdit(area)}
                                                    >
                                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                    </button>
                                                    <button 
                                                        className="btn btn-danger"
                                                        onClick={() => handleDelete(area.id)}
                                                    >
                                                        üóëÔ∏è ‡∏•‡∏ö
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3>{editingArea ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà'}</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà *</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                        <textarea
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                            rows="3"
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button type="button" className="btn" onClick={() => setShowModal(false)}>
                                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                        </button>
                                        <button type="submit" className="btn btn-success">
                                            {editingArea ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï' : '‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    <ConfirmModal
                        show={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                </div>
            );
        }

        // Note Manager Component
        function NoteManager({ notes, projects, areas, onUpdate, showMessage }) {
            const [showModal, setShowModal] = useState(false);
            const [editingNote, setEditingNote] = useState(null);
            const [selectedNotes, setSelectedNotes] = useState([]);
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                project_id: '',
                area_id: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const data = {
                        ...formData,
                        project_id: formData.project_id || null,
                        area_id: formData.area_id || null
                    };

                    if (editingNote) {
                        const { error } = await supabase
                            .from('notes')
                            .update(data)
                            .eq('id', editingNote.id);
                        if (error) throw error;
                        showMessage('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    } else {
                        const { error } = await supabase
                            .from('notes')
                            .insert([data]);
                        if (error) throw error;
                        showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    }

                    setShowModal(false);
                    setEditingNote(null);
                    setFormData({
                        title: '',
                        content: '',
                        project_id: '',
                        area_id: ''
                    });
                    onUpdate();
                } catch (err) {
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, 'error');
                }
            };

            const handleEdit = (note) => {
                setEditingNote(note);
                setFormData({
                    title: note.title,
                    content: note.content,
                    project_id: note.project_id || '',
                    area_id: note.area_id || ''
                });
                setShowModal(true);
            };

            const handleDelete = (noteId) => {
                const noteToDelete = notes.find(n => n.id === noteId);
                const noteTitle = noteToDelete ? noteToDelete.title : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏µ‡πâ';
                
                setConfirmModal({
                    isOpen: true,
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö "${noteTitle}"?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Attempting to delete note:', { id: noteId, title: noteTitle });
                            
                            const { error } = await supabase
                                .from('notes')
                                .delete()
                                .eq('id', noteId);

                            if (error) {
                                console.error('‚ùå Supabase delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å "${noteTitle}" ‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Note deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å "${noteTitle}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Unexpected delete error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleBulkDelete = () => {
                if (selectedNotes.length === 0) {
                    showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                    return;
                }

                const noteNames = selectedNotes.map(id => {
                    const note = notes.find(n => n.id === id);
                    return note ? note.title : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
                });

                setConfirmModal({
                    isOpen: true,
                    title: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${selectedNotes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                    message: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedNotes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n\nüìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö:\n${noteNames.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`,
                    onConfirm: async () => {
                        try {
                            console.log('üóëÔ∏è Bulk deleting notes:', selectedNotes);
                            
                            const { error } = await supabase
                                .from('notes')
                                .delete()
                                .in('id', selectedNotes);

                            if (error) {
                                console.error('‚ùå Bulk delete error:', error);
                                showMessage(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
                                return;
                            }
                            
                            console.log('‚úÖ Notes bulk deleted successfully');
                            showMessage(`‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedNotes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
                            setSelectedNotes([]);
                            await onUpdate();
                        } catch (err) {
                            console.error('‚ùå Bulk delete notes error:', err);
                            showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: ${err.message}`, 'error');
                        } finally {
                            setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} });
                        }
                    }
                });
            };

            const handleSelectNote = (noteId) => {
                setSelectedNotes(prev => 
                    prev.includes(noteId) 
                        ? prev.filter(id => id !== noteId)
                        : [...prev, noteId]
                );
            };

            const handleSelectAll = () => {
                if (selectedNotes.length === notes.length) {
                    setSelectedNotes([]);
                } else {
                    setSelectedNotes(notes.map(note => note.id));
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h2 style={{ color: '#78A3D4' }}>üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
                            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>
                                <button className="btn" onClick={() => setShowModal(true)}>
                                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà
                                </button>
                                {selectedNotes.length > 0 && (
                                    <button 
                                        className="btn btn-danger" 
                                        onClick={handleBulkDelete}
                                    >
                                        üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ({selectedNotes.length})
                                    </button>
                                )}
                            </div>
                        </div>

                        {selectedNotes.length > 0 && (
                            <div className="bulk-actions">
                                <span style={{ fontSize: '0.9rem', color: '#721c24' }}>
                                    üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß {selectedNotes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                                </span>
                                <button 
                                    className="btn btn-danger" 
                                    onClick={handleBulkDelete}
                                    style={{ margin: 0 }}
                                >
                                    üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ({selectedNotes.length})
                                </button>
                            </div>
                        )}

                        <div style={{ marginBottom: '15px', textAlign: 'center' }}>
                            <input
                                type="checkbox"
                                checked={selectedNotes.length === notes.length && notes.length > 0}
                                onChange={handleSelectAll}
                                style={{ marginRight: '8px' }}
                            />
                            <label style={{ fontSize: '0.9rem', color: '#666' }}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
                        </div>

                        <div className="grid-view">
                            {notes.map(note => (
                                <div key={note.id} className={`card ${selectedNotes.includes(note.id) ? 'selected-row' : ''}`}>
                                    <div style={{ display: 'flex', alignItems: 'flex-start', gap: '10px', marginBottom: '10px' }}>
                                        <input
                                            type="checkbox"
                                            checked={selectedNotes.includes(note.id)}
                                            onChange={() => handleSelectNote(note.id)}
                                            style={{ marginTop: '2px' }}
                                        />
                                        <div style={{ flex: 1 }}>
                                            <h3>{note.title}</h3>
                                            <p style={{ 
                                                maxHeight: '100px', 
                                                overflow: 'hidden', 
                                                textOverflow: 'ellipsis',
                                                whiteSpace: 'pre-wrap'
                                            }}>
                                                {note.content}
                                            </p>
                                            <div style={{ marginTop: '10px', fontSize: '0.9rem', opacity: 0.7 }}>
                                                {note.projects && <p><strong>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</strong> {note.projects.name}</p>}
                                                {note.areas && <p><strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</strong> {note.areas.name}</p>}
                                                <p><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> {new Date(note.created_at).toLocaleDateString('th-TH')}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div style={{ marginTop: '15px' }}>
                                        <button 
                                            className="btn"
                                            onClick={() => handleEdit(note)}
                                        >
                                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <button 
                                            className="btn btn-danger"
                                            onClick={() => handleDelete(note.id)}
                                        >
                                            üóëÔ∏è ‡∏•‡∏ö
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {showModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3>{editingNote ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà'}</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ *</label>
                                        <input
                                            type="text"
                                            value={formData.title}
                                            onChange={(e) => setFormData({...formData, title: e.target.value})}
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ *</label>
                                        <textarea
                                            value={formData.content}
                                            onChange={(e) => setFormData({...formData, content: e.target.value})}
                                            rows="6"
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</label>
                                        <select
                                            value={formData.project_id}
                                            onChange={(e) => setFormData({...formData, project_id: e.target.value})}
                                        >
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ --</option>
                                            {projects.map(project => (
                                                <option key={project.id} value={project.id}>
                                                    {project.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</label>
                                        <select
                                            value={formData.area_id}
                                            onChange={(e) => setFormData({...formData, area_id: e.target.value})}
                                        >
                                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà --</option>
                                            {areas.map(area => (
                                                <option key={area.id} value={area.id}>
                                                    {area.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button type="button" className="btn" onClick={() => setShowModal(false)}>
                                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                        </button>
                                        <button type="submit" className="btn btn-success">
                                            {editingNote ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï' : '‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    <ConfirmModal
                        show={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: () => {} })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                    />
                </div>
            );
        }

        // Render the app using the new React 18 createRoot API
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
ÔøΩ